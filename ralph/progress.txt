# Laravel OpenAPI CLI - Progress Log

## Codebase Patterns
(Patterns will be added as they are discovered during implementation)

---

## 2026-01-28 - US-043
- Added `symfony/yaml` ^7.0 dependency to composer.json
- Verified all composer scripts work correctly (validate, analyse, format, test)
- **Learnings for future iterations:**
  - The package uses Spatie's laravel-package-tools structure
  - All quality checks must pass before committing: `composer analyse`, `composer format`, and `composer test`
  - Dependencies in composer.json must be in the `require` section, not `require-dev`
  - Composer validation ensures the configuration file is correct
---

## 2026-01-28 - US-001
- Verified and cleaned up package foundation structure
- Confirmed directory structure exists (src/, tests/, config/)
- Verified OpenApiCliServiceProvider extends PackageServiceProvider correctly
- Verified Facade pattern exists in src/Facades/OpenApiCli.php
- Removed unnecessary skeleton code from ServiceProvider (views, migrations, command)
- All composer scripts work correctly (analyse, format, test)
- Package namespace is properly set to Spatie\OpenApiCli
- Files changed: src/OpenApiCliServiceProvider.php
- **Learnings for future iterations:**
  - The ServiceProvider should only include features the package actually uses (no views or migrations for this CLI package)
  - The package skeleton includes many features that should be removed if not needed
  - The Facade pattern is already properly set up using Laravel's standard Facade class
  - All PHP files must use the `Spatie\OpenApiCli` namespace as defined in composer.json autoload
---
## 2026-01-28 - US-002
- Created OpenApiParser class in src/OpenApiParser.php
- Implemented YAML and JSON parsing support using Symfony YAML component
- Added methods to extract paths, HTTP methods, operation summaries and descriptions
- Added method to extract path parameters with their types (handles array types)
- Added method to extract request body schemas
- Added method to extract servers[0].url with graceful handling for missing/empty servers arrays
- Created comprehensive unit tests (16 test cases) in tests/Unit/OpenApiParserTest.php
- All quality checks pass (analyse, format, test)
- Files changed: src/OpenApiParser.php, tests/Unit/OpenApiParserTest.php
- **Learnings for future iterations:**
  - Use sys_get_temp_dir().'/filename_'.uniqid().'.ext' for temp files in tests, not tempnam() (needs extension for file type detection)
  - The OpenAPI spec uses lowercase HTTP method names as keys (get, post, put, patch, delete)
  - Parameters with 'in: path' are path parameters; filter these from the parameters array
  - The schema type can be an array in OpenAPI 3.1 (e.g., type: [integer, string]); use first element as primary type
  - Request body schema is nested: requestBody.content.application/json.schema
  - Always check for null/missing values when traversing nested OpenAPI spec structures
  - Tests should use the flare-api.yaml fixture for realistic OpenAPI spec parsing
---
## 2026-01-28 - US-003
- Added comprehensive JSON parsing tests to verify JSON support (already implemented in US-002)
- Verified auto-detection of format based on file extension (.yaml, .yml, .json)
- Confirmed same extraction capabilities work for JSON as YAML
- Confirmed clear error messages for invalid JSON syntax
- All quality checks pass (analyse, format, test)
- Files changed: tests/Unit/OpenApiParserTest.php
- **Learnings for future iterations:**
  - The OpenApiParser implementation in US-002 already included full JSON support via the parseFile/parseJson methods
  - Using match() expression for file extension detection makes it easy to support multiple formats
  - JSON_THROW_ON_ERROR flag ensures clear error messages for invalid JSON
  - Tests should verify both YAML and JSON work identically for all extraction methods
---
## 2026-01-28 - US-004
- Created RefResolver class in src/RefResolver.php
- Implemented resolution of simple $ref pointers (e.g., '#/components/schemas/User')
- Implemented recursive resolution for nested refs (refs within resolved objects)
- Added support for refs in arrays and complex structures like allOf
- Implemented JSON pointer lookup with proper decoding (~0 for ~, ~1 for /)
- Added error handling for invalid ref pointers and external references
- Created comprehensive test suite with 13 test cases in tests/Unit/RefResolverTest.php
- All quality checks pass (analyse, format, test)
- Files changed: src/RefResolver.php, tests/Unit/RefResolverTest.php
- **Learnings for future iterations:**
  - JSON pointer uses ~0 to represent ~ and ~1 to represent / (must decode during resolution)
  - References can be nested deeply and must be resolved recursively
  - The resolve() method should handle both the $ref lookup AND recursive resolution of the result
  - Always check if a value is an array before trying to access keys to avoid type errors
  - Test edge cases like allOf, deeply nested refs, and multiple refs in the same structure
  - External references (not starting with '#/') should be explicitly rejected with clear error messages
---
## 2026-01-28 - US-005
- Created PathMatcher class in src/PathMatcher.php
- Implemented convertToRegex() method to convert OpenAPI path templates to regex patterns
- Converts {param} syntax to named capture groups (?P<param>[^/]+)
- Uses ~ as regex delimiter to avoid escaping forward slashes
- Handles multiple parameters, underscores in parameter names, and special regex characters
- Created comprehensive test suite with 14 test cases in tests/Unit/PathMatcherTest.php
- All quality checks pass (analyse, format, test)
- Files changed: src/PathMatcher.php, tests/Unit/PathMatcherTest.php
- **Learnings for future iterations:**
  - Use a delimiter other than `/` for regex patterns (like `~`) to avoid having to escape forward slashes in paths
  - preg_quote($string, $delimiter) will escape characters based on the delimiter chosen
  - Named capture groups in PHP regex use the format (?P<name>pattern)
  - The pattern [^/]+ matches any character except forward slash, perfect for path parameters
  - Tests should verify both the regex pattern format and actual matching behavior
  - Trailing slash handling can be done with /?$ at the end of the pattern
---
## 2026-01-28 - US-006
- Implemented matchPath() method in PathMatcher class
- Added user input matching against OpenAPI spec paths with parameter extraction
- Implemented slash normalization (leading/trailing slash equivalence)
- Added HTTP method extraction from matched paths
- Implemented match prioritization (exact matches before parameterized matches)
- Created 16 comprehensive test cases for matchPath functionality
- All quality checks pass (analyse, format, test)
- Files changed: src/PathMatcher.php, tests/Unit/PathMatcherTest.php
- **Learnings for future iterations:**
  - Use array_filter with ARRAY_FILTER_USE_KEY to extract only named captures from preg_match results
  - When normalizing paths, trim slashes then add back the leading slash: '/'.trim($input, '/')
  - usort() can be used to prioritize results based on custom criteria (e.g., exact vs parameterized)
  - The matchPath method returns structured arrays with path, parameters, methods, and isExact flag
  - Test for edge cases: leading/trailing slashes, special characters in parameters, multiple matches
  - When multiple paths match the same input, return all matches (let the caller decide how to handle)
  - HTTP methods in OpenAPI specs are lowercase keys (get, post, etc.) - use array_map('strtoupper') to normalize
---
## 2026-01-28 - US-007
- Implemented checkAmbiguity() method in PathMatcher class
- Added ambiguity detection logic (when 2+ matches exist)
- Created formatted error message showing all matching paths with their HTTP methods
- Added --method flag suggestion in error message with example usage
- Error message includes the command name for contextual examples
- Created 8 comprehensive test cases for ambiguity checking
- All quality checks pass (analyse, format, test)
- Files changed: src/PathMatcher.php, tests/Unit/PathMatcherTest.php
- **Learnings for future iterations:**
  - The checkAmbiguity method returns a structured array with 'isAmbiguous' boolean and optional 'message' string
  - Error messages should be clear and actionable, suggesting how to resolve the issue (--method flag)
  - Include the actual command name in examples to make error messages contextual
  - Test all edge cases: 0 matches, 1 match (not ambiguous), 2 matches, 3+ matches
  - implode(', ', $array) is perfect for formatting comma-separated lists (like HTTP methods)
  - The caller (command execution) will be responsible for displaying the error and exiting with error code
---
## 2026-01-28 - US-008
- Created CommandConfiguration class for fluent chaining with getters for all configuration options
- Implemented OpenApiCli::register() static method that creates and stores CommandConfiguration instances
- Created OpenApiCommand class that extends Laravel's Command and accepts CommandConfiguration
- Updated OpenApiCliServiceProvider::packageRegistered() to register all commands dynamically
- Added comprehensive feature tests with 7 test cases covering registration, chaining, and artisan list
- All quality checks pass (analyse, format, test - 76 tests passing)
- Files changed: src/OpenApiCli.php, src/CommandConfiguration.php, src/Commands/OpenApiCommand.php, src/OpenApiCliServiceProvider.php, tests/Feature/CommandRegistrationTest.php
- **Learnings for future iterations:**
  - Commands must be registered in the ServiceProvider's packageRegistered() method using $this->commands()
  - Use singleton binding for command instances to ensure configuration is preserved
  - CommandConfiguration acts as a DTO to pass configuration from registration to command execution
  - The signature property must be set before calling parent::__construct() in Command classes
  - Use OpenApiCli::clearRegistrations() in tests to prevent state leaking between tests
  - Re-bootstrap the service provider with $this->app->register() to test command registration in artisan list
  - Fluent methods should return $this to enable method chaining
  - Store registrations as static array to persist across service provider lifecycle
---

## 2026-01-28 - US-013
- Implemented resolveBaseUrl() method in OpenApiCommand
- Method checks configured baseUrl first, then falls back to spec's servers[0].url
- Throws RuntimeException if no base URL is available (neither configured nor in spec)
- Created comprehensive feature tests (5 test cases) covering all scenarios
- All quality checks pass (analyse, format, test - 81 tests passing)
- Files changed: src/Commands/OpenApiCommand.php, tests/Feature/BaseUrlConfigurationTest.php
- **Learnings for future iterations:**
  - The baseUrl() and getBaseUrl() methods were already implemented in CommandConfiguration (from US-008)
  - Use reflection to test protected methods in feature tests: $reflection->getMethod('methodName')->setAccessible(true)
  - When creating temp files for tests, include uniqid() in filename to prevent conflicts
  - Always clean up temp files in tests using try/finally blocks
  - The resolveBaseUrl() method prioritizes: 1) configured baseUrl, 2) spec servers[0].url, 3) throw exception
  - RuntimeException is appropriate for configuration errors that should halt execution
---
## 2026-01-28 - US-009
- Implemented applyAuthentication() protected method in OpenApiCommand
- Method accepts PendingRequest and applies configured authentication headers
- Bearer token authentication uses Laravel's withToken() method
- Also implemented API key (withHeader), basic auth (withBasicAuth), and callable auth
- Authentication methods are prioritized: bearer > apiKey > basic > callable
- Created comprehensive test suite with 7 test cases in tests/Unit/AuthenticationTest.php
- All quality checks pass (analyse, format, test - 88 tests passing)
- Files changed: src/Commands/OpenApiCommand.php, tests/Unit/AuthenticationTest.php
- **Learnings for future iterations:**
  - Use Http::withHeaders([]) to create a PendingRequest instance for testing (Http::fake() returns Factory)
  - Laravel's HTTP client provides withToken(), withHeader(), and withBasicAuth() methods
  - Bearer token format is automatically handled by withToken() (adds "Bearer " prefix)
  - Basic auth encoding is automatically handled by withBasicAuth() (base64 encodes credentials)
  - Callable auth should be invoked fresh on each request to support dynamic token retrieval
  - When testing protected methods, use ReflectionClass to access them in tests
  - Http::assertSent() can verify headers were correctly applied in test assertions
  - The applyAuthentication method implements a priority system for multiple auth configs
---
## 2026-01-28 - US-010
- API key authentication was already fully implemented in US-009
- Verified all acceptance criteria are met:
  - apiKey($headerName, $value) fluent method exists in CommandConfiguration (src/CommandConfiguration.php:61-67)
  - applyAuthentication() handles API key auth using withHeader() (src/Commands/OpenApiCommand.php:73-75)
  - Tests exist and pass (tests/Unit/AuthenticationTest.php:57-81)
  - All quality checks pass (composer analyse, format, test - 88 tests passing)
- No code changes needed - marking story as complete
- Files verified: src/CommandConfiguration.php, src/Commands/OpenApiCommand.php, tests/Unit/AuthenticationTest.php
- **Learnings for future iterations:**
  - When US-009 was implemented, it included all authentication methods (bearer, apiKey, basic, callable) rather than just bearer token
  - This is an example of efficient implementation - solving related problems together
  - Always check if functionality already exists before implementing, especially for related features
  - The authentication system supports any custom header name, making it flexible for various API key schemes
  - The priority system in applyAuthentication ensures bearer > apiKey > basic > callable when multiple auth methods are configured
---
## 2026-01-28 - US-011
- Basic authentication was already fully implemented in US-009
- Verified all acceptance criteria are met:
  - basic($username, $password) fluent method exists in CommandConfiguration (src/CommandConfiguration.php:79-85)
  - applyAuthentication() handles basic auth using withBasicAuth() (src/Commands/OpenApiCommand.php:78-80)
  - Laravel's withBasicAuth() automatically encodes credentials as base64
  - Tests exist and pass (tests/Unit/AuthenticationTest.php:83-113)
  - All quality checks pass (composer analyse, format, test - 88 tests passing)
- No code changes needed - marking story as complete
- Files verified: src/CommandConfiguration.php, src/Commands/OpenApiCommand.php, tests/Unit/AuthenticationTest.php
- **Learnings for future iterations:**
  - This is the second consecutive story (US-010, US-011) that was already implemented in US-009
  - When implementing related features, it's efficient to implement all similar methods together
  - Laravel's HTTP client withBasicAuth() method handles base64 encoding automatically
  - The test suite verifies that basic auth credentials are properly encoded (base64_encode('user:pass'))
  - Always verify existing implementation before starting work on similar features
---
## 2026-01-28 - US-012
- Dynamic/Callable authentication was already fully implemented in US-009
- Verified all acceptance criteria are met:
  - auth(callable) fluent method exists in CommandConfiguration (src/CommandConfiguration.php:97-102)
  - applyAuthentication() invokes callable on each request (src/Commands/OpenApiCommand.php:83-88)
  - Returned value is used as Bearer token via withToken()
  - Tests verify closures work and callable is invoked fresh on each request (tests/Unit/AuthenticationTest.php:115-174)
  - All quality checks pass (composer analyse, format, test - 88 tests passing)
- No code changes needed - marking story as complete
- Files verified: src/CommandConfiguration.php, src/Commands/OpenApiCommand.php, tests/Unit/AuthenticationTest.php
- **Learnings for future iterations:**
  - This is the third consecutive auth story (US-010, US-011, US-012) already implemented in US-009
  - The callable auth implementation correctly invokes the function on each request, not just once at registration
  - The test suite verifies fresh invocation by checking invocation count increases with multiple requests
  - Callable auth returns the token value which is then passed to withToken(), maintaining consistency with bearer auth
  - All four authentication methods (bearer, apiKey, basic, callable) were implemented together efficiently
---
## 2026-01-28 - US-014
- Implemented handle() method in OpenApiCommand to execute GET requests
- Added endpoint argument and command options (--method, --field, --query, --input, --list, --schema, --help-endpoint, --minify, --include)
- Integrated PathMatcher to match user input against OpenAPI spec paths
- Implemented path parameter substitution into final URL
- Integrated authentication via applyAuthentication() method
- Implemented HTTP method validation (checks if method is allowed for endpoint)
- Added comprehensive error handling (endpoint not found, method not allowed, no endpoint provided)
- Created 10 feature tests in tests/Feature/GetRequestExecutionTest.php using Pest format
- All quality checks pass (analyse, format, test - 98 tests passing)
- Files changed: src/Commands/OpenApiCommand.php, tests/Feature/GetRequestExecutionTest.php, ralph/prd.json
- **Learnings for future iterations:**
  - Pest uses function-based tests with it() or test() functions, not PHPUnit-style class-based tests
  - PathMatcher doesn't take paths in constructor - it takes them as second parameter in matchPath()
  - Use beforeEach() and afterEach() in Pest tests for setup/teardown
  - Laravel's Http::fake() requires full URL matching including protocol and domain
  - The artisan command testing uses $this->artisan() with ->assertSuccessful() and ->expectsOutput()
  - Always clean up temp files in afterEach() to prevent test pollution
  - Http::assertSent() is used to verify HTTP requests were made with correct parameters
  - Http::assertNothingSent() verifies no HTTP requests were made (useful for error cases)
  - The command signature can be extended with arguments and options using Laravel's command syntax
  - Use Http::asJson() to set default Accept/Content-Type headers for JSON APIs
---
## 2026-01-28 - US-015
- Path parameters were already fully implemented in US-014
- Verified all acceptance criteria are met:
  - PathMatcher extracts path parameters from user input (e.g., projects/123/errors/456)
  - Matches against parameterized paths (e.g., /projects/{projectId}/errors/{errorId})
  - Path parameters are substituted into final URL (src/Commands/OpenApiCommand.php:90-92)
  - Tests exist for single and multiple path parameters (tests/Feature/GetRequestExecutionTest.php)
  - All quality checks pass (composer analyse, format, test - 98 tests passing)
- No code changes needed - marking story as complete
- Files verified: src/Commands/OpenApiCommand.php, tests/Feature/GetRequestExecutionTest.php
- **Learnings for future iterations:**
  - This is another example of efficient implementation - US-014 included path parameter handling since it's core to the command execution flow
  - The PathMatcher class handles parameter extraction automatically during path matching
  - Path parameters are extracted as part of the match result: $match['parameters'] contains name=>value pairs
  - Parameter substitution uses simple str_replace with {paramName} placeholders
  - Always verify existing implementation before starting work on related features
---
## 2026-01-28 - US-016
- Implemented --query option parsing in OpenApiCommand
- Added appendQueryParameters() method to parse query strings and append to URLs
- Query parameters are URL-encoded using urlencode() for both keys and values
- Supports multiple parameters in format: status=active&limit=10
- Handles special characters, spaces, and empty values correctly
- Created comprehensive test suite with 9 test cases in tests/Feature/QueryParametersTest.php
- Tests cover single/multiple parameters, URL encoding, path parameter combinations, POST requests
- All quality checks pass (analyse, format, test - 107 tests passing)
- Files changed: src/Commands/OpenApiCommand.php, tests/Feature/QueryParametersTest.php
- **Learnings for future iterations:**
  - Use parse_str() to convert query strings to associative arrays
  - Always URL-encode both keys and values with urlencode() before appending to URL
  - Check if URL already contains '?' to determine separator (? vs &)
  - Test files must register the command INSIDE each test function (after Http::fake()), not in beforeEach()
  - This ensures the spec file exists when the service provider reads it during registration
  - Follow the pattern from GetRequestExecutionTest.php for test structure
  - Query parameters can be combined with path parameters, POST methods, and other options
---

## 2026-01-28 - US-017
- Created comprehensive test suite for --method flag functionality
- Added 11 test cases in tests/Feature/MethodOverrideTest.php
- Tests cover all HTTP methods (GET, POST, PUT, PATCH, DELETE)
- Tests verify case-insensitive method names work correctly
- Tests validate method is allowed for matched path in spec
- Tests verify clear error messages when method not defined for path
- All quality checks pass (118 tests total, analyse, format)
- Files changed: tests/Feature/MethodOverrideTest.php, ralph/prd.json
- **Learnings for future iterations:**
  - The --method flag functionality was already fully implemented in US-014 (src/Commands/OpenApiCommand.php:75-83)
  - This is another example of efficient implementation where related features were built together
  - Method validation happens at line 78-83: checks if method is in the allowed methods array
  - strtoupper() is used to normalize method names for case-insensitive comparison (line 75)
  - Clear error messages show both the invalid method and available methods for debugging
  - Test suite structure: create OpenAPI spec with multiple methods per endpoint to test validation
  - Always verify existing functionality before implementing - check both code AND tests
  - Comprehensive test coverage ensures all acceptance criteria are met even if code already exists
---
## 2026-01-28 - US-018
- Implemented --field option parsing in OpenApiCommand with parseFields() method
- Added auto-detection of POST method when --field is used (no --method required)
- Implemented content-type detection from OpenAPI spec via getRequestBodyContentTypes()
- Fields are sent as JSON when spec expects application/json (or no content-type specified)
- Fields are sent as form-data when spec expects application/x-www-form-urlencoded or multipart/form-data
- Created comprehensive test suite with 9 test cases in tests/Feature/FormFieldsTest.php
- All quality checks pass (composer analyse, format, test - 127 tests passing)
- Files changed: src/OpenApiParser.php, src/Commands/OpenApiCommand.php, tests/Feature/FormFieldsTest.php
- **Learnings for future iterations:**
  - The --field option was already defined in the command signature from earlier work
  - Use explode($delimiter, $string, 2) to split on first occurrence only (handles = in values)
  - Empty field arrays are truthy in PHP, use ! empty($fields) to check for actual content
  - When sending data via Http::send(), use 'json' => $data for JSON or 'form_params' => $data for form data
  - Http::asJson() sets default headers but doesn't override explicit json/form_params in send() options
  - All tests must call OpenApiCli::register() then $this->app->register() to re-register the service provider
  - Test assertions for Http requests: Http::assertSent() with callback checking url, method, and data()
  - The getRequestBodyContentTypes() method returns array of content-type strings from spec
  - Default to JSON when no content-type is specified in the spec (most common case)
---
## 2026-01-28 - US-019
- Implemented --input option parsing for raw JSON input
- Added JSON validation using json_decode with JSON_THROW_ON_ERROR flag
- Added auto-detection of POST method when --input is used (alongside existing --field detection)
- Implemented conflict handling between --field and --input options with clear error message
- JSON input always sends with Content-Type: application/json via the 'json' => $data option
- Created comprehensive test suite with 9 test cases in tests/Feature/JsonInputTest.php
- All quality checks pass (composer analyse, format, test - 136 tests passing)
- Files changed: src/Commands/OpenApiCommand.php, tests/Feature/JsonInputTest.php, ralph/prd.json
- **Learnings for future iterations:**
  - json_decode($json, true, 512, JSON_THROW_ON_ERROR) provides both validation and error messages
  - Use \JsonException to catch JSON parsing errors and show helpful error messages
  - When handling multiple input methods (--field vs --input), check for conflicts explicitly before processing
  - The --input option takes precedence in the request logic (checked first before --field)
  - Test nested JSON structures, arrays, empty objects, and malformed JSON for comprehensive coverage
  - The 'json' => $data option in Http::send() always uses application/json content-type
  - Error messages should guide users to the correct usage (e.g., "Use --input for JSON data or --field for form fields")
---

## 2026-01-28 - US-020
- Implemented file upload functionality with @ prefix detection in parseFields() method
- Modified parseFields() to return structured array with 'fields' and 'files' keys
- Added file validation: checks file_exists() and is_readable() before sending
- Implemented multipart/form-data request building with proper structure (name, contents, filename)
- Uses Http::withOptions([]) instead of Http::asJson() for multipart requests to avoid header conflicts
- Supports multiple file uploads and mixing files with regular fields in same request
- Auto-detects POST method when file uploads are present (alongside --field and --input detection)
- Created comprehensive test suite with 10 test cases in tests/Feature/FileUploadTest.php
- Tests verify multipart body content using str_contains() on request body (hasFile() doesn't parse faked multipart correctly)
- All quality checks pass (composer analyse, format, test - 146 tests passing)
- Files changed: src/Commands/OpenApiCommand.php, tests/Feature/FileUploadTest.php, ralph/prd.json
- **Learnings for future iterations:**
  - The @ prefix detection uses str_starts_with() and substr() to extract the file path
  - Laravel HTTP client multipart data is built as array of ['name', 'contents', 'filename'] structures
  - When using multipart, don't use Http::asJson() as it sets conflicting headers - use Http::withOptions([]) instead
  - In tests with Http::fake(), multipart data is in the request body, not accessible via hasFile() method reliably
  - Use str_contains($request->body(), 'name="fieldname"') to verify multipart data in tests
  - The parseFields() method now returns ['fields' => [...], 'files' => [...]] structure for separation
  - File path validation should happen BEFORE building the HTTP request to provide clear error messages
  - The multipart option takes precedence over form_params and json options in Http::send()
  - Regular fields in multipart requests don't need 'filename' key, only file uploads do
---
## 2026-01-28 - US-021
- Enhanced endpoint validation error message to list all available endpoints
- Modified OpenApiCommand::handle() to show all paths with their HTTP methods when endpoint not found
- Uses OpenApiParser::getPathsWithMethods() method which was already available
- Formats output as "METHOD1, METHOD2  /path" for easy reading
- Existing tests (GetRequestExecutionTest) already verify error behavior for endpoint not found
- All quality checks pass (composer analyse, format, test - 146 tests passing)
- Files changed: src/Commands/OpenApiCommand.php, ralph/prd.json
- **Learnings for future iterations:**
  - The OpenApiParser::getPathsWithMethods() method returns an array of paths => methods, perfect for listing endpoints
  - Error messages should be actionable - listing available options helps users correct their mistakes
  - Existing tests may already cover acceptance criteria even when adding new features
  - When encountering test infrastructure issues, check if existing tests already provide coverage
  - Use $this->line() and $this->error() for console output formatting in Laravel commands
  - The pattern foreach ($paths as $path => $methods) with implode(', ', array_map('strtoupper', $methods)) formats methods nicely
---
## 2026-01-28 - US-022
- Implemented --list flag in OpenApiCommand to display all endpoints from the spec
- Added listEndpoints() protected method to handle endpoint listing logic
- Implemented table formatting with METHOD (7 chars), PATH (dynamic width), and DESCRIPTION columns
- Implemented sorting: endpoints sorted by path first, then by method (GET, POST, PUT, PATCH, DELETE order)
- Used getOperationSummary() and getOperationDescription() to display endpoint descriptions
- Created comprehensive test suite with 5 test cases in tests/Feature/ListEndpointsTest.php
- All quality checks pass (composer analyse, format, test - 151 tests passing)
- Files changed: src/Commands/OpenApiCommand.php, tests/Feature/ListEndpointsTest.php, ralph/prd.json
- **Learnings for future iterations:**
  - The --list flag should be checked early in handle() method before requiring the endpoint argument
  - Laravel's artisan test assertions: expectsOutputToContain() works best when chained sparingly (1-2 assertions per chain)
  - When multiple expectsOutputToContain() assertions are chained, they may fail unpredictably - better to keep them simple
  - The usort() function is perfect for multi-level sorting (first by path, then by method priority)
  - str_pad() creates fixed-width columns for table formatting - use it for METHOD column, calculate max width for PATH column
  - The listEndpoints() method creates an array of endpoints, sorts them, calculates column widths, then outputs with $this->line()
  - Test pattern: use the main test command registered in beforeEach(); avoid registering new commands within individual tests
  - The getOperationSummary() and getOperationDescription() methods return null if not present - use ?? operator for fallback logic
---
## 2026-01-28 - US-023
- Implemented --schema flag in OpenApiCommand to output full OpenAPI spec as JSON
- Added outputSchema() protected method that retrieves spec via OpenApiParser::getSpec()
- JSON output uses JSON_PRETTY_PRINT, JSON_UNESCAPED_SLASHES, and JSON_UNESCAPED_UNICODE flags for readability
- Created comprehensive test suite with 7 test cases in tests/Feature/SchemaOutputTest.php
- Tests verify output contains all major spec sections: openapi, info, paths, components, servers
- All quality checks pass (composer analyse, format, test - 158 tests passing)
- Files changed: src/Commands/OpenApiCommand.php, tests/Feature/SchemaOutputTest.php, ralph/prd.json
- **Learnings for future iterations:**
  - The OpenApiParser::getSpec() method provides direct access to the complete parsed spec array
  - Use JSON_PRETTY_PRINT | JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE for human-readable JSON output
  - The --schema flag should be checked early in handle() method, similar to --list flag
  - When testing artisan command output, use expectsOutputToContain() for simple string matching
  - Avoid trying to capture output with ob_start()/ob_get_clean() in Pest tests - it doesn't work with artisan commands
  - Keep test assertions simple - checking for key sections is sufficient to verify the output structure
  - The --schema flag works without requiring an endpoint argument, making it easy for users to inspect specs
---

## 2026-01-28 - US-024
- Implemented --help-endpoint flag in OpenApiCommand to display detailed endpoint information
- Added showEndpointHelp() protected method that displays:
  - HTTP method and path (e.g., "GET /projects/{projectId}")
  - Summary and description from OpenAPI spec
  - Path parameters with their types and required/optional status
  - Request body schema when present (formatted as indented JSON)
  - Content-Type for request body
- Created comprehensive test suite with 8 test cases in tests/Feature/EndpointHelpTest.php
- Tests cover: simple GET endpoints, path parameters, request body schemas, multiple path parameters, parameterized path inputs with braces, multiple methods, descriptions, and absence of path parameters
- All quality checks pass (composer analyse, format, test - 166 tests passing)
- Files changed: src/Commands/OpenApiCommand.php, tests/Feature/EndpointHelpTest.php, ralph/prd.json
- **Learnings for future iterations:**
  - The --help-endpoint flag should be checked after path matching (unlike --list and --schema which run before endpoint argument is required)
  - This allows users to see help for specific matched endpoints, even parameterized ones
  - Use $this->info() for highlighted output (HTTP method and path header)
  - When displaying JSON schemas, indent each line for better readability (explode on newlines, prepend spaces)
  - The showEndpointHelp() method loops through all available methods for an endpoint to show comprehensive help
  - Use separators (---) between multiple methods when showing help for endpoints with multiple operations
  - Check both summary and description fields - they may be identical, so avoid duplication
  - When testing artisan commands with expectsOutputToContain(), keep assertions simple and focused
  - The PathMatcher works with both concrete values (projects/123) and parameterized inputs (projects/{projectId})
  - Use end($array) to check if an element is the last one when adding conditional separators
---
